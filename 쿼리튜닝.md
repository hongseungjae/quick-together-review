자기가 속한 프로젝트 상세 조회 시 날아가는 주요 쿼리는 다음과 같다.

1. 프로젝트 정보, 구성원, 멤버를 가져오는 쿼리
2. 포스트 쿼리
3. 좋아요 합계 쿼리

그러나 실제 날아가는 쿼리를 보면 추가적으로
프로젝트 스킬스택들 대한 쿼리
프로젝트 구인포지션들 대한 쿼리
해당 프로젝트 구성원들에 대한 스킬스택들, 구인포지션들 쿼리들이 발생하고 있음

확인결과 컬렉션들에 대해서 N+1 문제가 발생하고 있었다.
N+1 문제를 해결하기 위해 JOIN FETCH를 이용할 것이다.

기존 쿼리
    @Query("select p from Project p " +
            "join fetch p.participants.participants.member " +
            "where p.Id = :projectId")
    Optional<Project> findByProjectIdWithDetail(@Param("projectId") Long projectId);

프로젝트 스킬스택들과 구인포지션들 일대다(컬렉션 애들)
EAGER -> LAZY로 바꾸고 로딩 시
프록시 객체로 인한 에러발생
org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.flab.quicktogether.project.domain.Project.skillStacks: could not initialize proxy - no Session

JPA에서는 List 타입의 컬렉션을 조인하면 기본적으로 Eager Loading을 사용하기 때문입니다. 따라서, Lazy Loading을 사용하고자 할 때는 명시적으로 FetchType.LAZY를 사용하여 지연 로딩을 설정해주어야 합니다.

따라서 조인 fetch로 미리 가져올 시
org.hibernate.loader.MultipleBagFetchException: cannot simultaneously fetch multiple bags

일대다 컬렉션 여러개는  join fetch로 가져올 수가 없음

해결방법
1. set을 변경
2. batch size 설정으로 in을 활용 -> 우리는 단일 조회기 때문에 별로 필요가 없음

https://jojoldu.tistory.com/457
